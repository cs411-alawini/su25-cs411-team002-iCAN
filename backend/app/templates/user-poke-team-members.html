<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>User Pokémon Team Members</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
        }
        h1, h2 {
            margin-bottom: 20px;
        }
        table {
            border-collapse: collapse;
            width: 90%;
            margin-bottom: 40px;
        }
        th, td {
            border: 1px solid #aaa;
            padding: 10px;
            text-align: left;
        }
        th {
            background-color: #eee;
        }
        .back-link {
            margin-top: 20px;
            display: inline-block;
        }
    </style>
</head>
<body>

    <h1>All User Pokémon Team Members</h1>
    
    <!-- Search by user_team_id -->
    <h2>Search Team Members by Team ID</h2>
    <form action="/user-poke-team-members/search" method="post">
        <label for="user_team_id">Enter Team ID:</label>
        <input type="number" id="user_team_id" name="user_team_id" required>
        <input type="submit" value="Search">
    </form>

    <h2>Add Pokémon to a Team</h2>
    <form action="/user-poke-team-members/add" method="post">
        <label for="user_team_id">Team ID:</label>
        <input type="number" id="user_team_id" name="user_team_id" required><br><br>

        <label for="pokedex_id">Pokédex ID:</label>
        <input type="number" id="pokedex_id" name="pokedex_id" required><br><br>

        <!-- Pokémon Preview -->
        <div id="pokemon-preview" style="margin-top: 1em;">
            <strong>Name:</strong> <span id="pokemon-name">N/A</span><br>
            <img id="pokemon-image" src="" alt="Pokémon Image" style="display: none; height: 100px;">
        </div>

        <!-- Let JavaScript dynamically populate move dropdowns -->
        <div id="move-selects">
            <label>Move 1:</label>
            <select name="move_1_id" required></select><br><br>
            <label>Move 2:</label>
            <select name="move_2_id" required></select><br><br>
            <label>Move 3:</label>
            <select name="move_3_id" required></select><br><br>
            <label>Move 4:</label>
            <select name="move_4_id" required></select><br><br>
        </div>

        <input type="submit" value="Add Pokémon">
    </form>

    <script>
        document.querySelector('#pokedex_id').addEventListener('change', function () {
            const pokedexId = this.value;
            fetch(`/user-poke-team-members/moves/${pokedexId}`)
                .then(response => response.json())
                .then(data => {
                    // Show Pokémon name and image
                    document.getElementById('pokemon-name').textContent = data.pokemon.name;
                    const image = document.getElementById('pokemon-image');
                    image.src = data.pokemon.image_url;
                    image.style.display = 'block';

                    // Populate move dropdowns
                    const selects = document.querySelectorAll('#move-selects select');
                    selects.forEach(select => {
                        select.innerHTML = '';
                        data.moves.forEach(move => {
                            const option = document.createElement('option');
                            option.value = move.move_id;
                            option.textContent = `${move.move_name} (PP: ${move.pp})`;
                            select.appendChild(option);
                        });
                    });
                });
        });
    </script>

    {% if entries %}
        <table>
            <thead>
                <tr>
                    {% for column in entries[0].keys() %}
                        <th>{{ column }}</th>
                    {% endfor %}
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for row in entries %}
                    <tr>
                        {% for value in row.values() %}
                            <td>{{ value }}</td>
                        {% endfor %}
                        <td>
                            <form action="/user-poke-team-members/delete" method="post" style="display:inline;">
                                <input type="hidden" name="user_team_id" value="{{ row.user_team_id }}">
                                <input type="hidden" name="user_team_member_id" value="{{ row.user_team_member_id }}">
                                <input type="submit" value="Remove">
                            </form>
                            <form action="/user-poke-team-members/edit" method="get" style="display:inline;">
                                <input type="hidden" name="user_team_id" value="{{ row.user_team_id }}">
                                <input type="hidden" name="user_team_member_id" value="{{ row.user_team_member_id }}">
                                <input type="submit" value="Edit">
                            </form>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>

    {% elif members %}
        <h1>Pokémon Team Members for Team ID: {{ members[0]['user_team_id'] if members else '' }}</h1>
        <table>
            <thead>
                <tr>
                    {% for column in members[0].keys() %}
                        <th>{{ column }}</th>
                    {% endfor %}
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for row in members %}
                    <tr>
                        {% for value in row.values() %}
                            <td>{{ value }}</td>
                        {% endfor %}
                        <td>
                            <form action="/user-poke-team-members/delete" method="post" style="display:inline;">
                                <input type="hidden" name="user_team_id" value="{{ row.user_team_id }}">
                                <input type="hidden" name="user_team_member_id" value="{{ row.user_team_member_id }}">
                                <input type="submit" value="Remove">
                            </form>
                            <form action="/user-poke-team-members/edit" method="get" style="display:inline;">
                                <input type="hidden" name="user_team_id" value="{{ row.user_team_id }}">
                                <input type="hidden" name="user_team_member_id" value="{{ row.user_team_member_id }}">
                                <input type="submit" value="Edit">
                            </form>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        <a href="/user-poke-team-members" class="back-link">← Back to All Team Members</a>

    {% else %}
        <p>No team member data found.</p>
    {% endif %}

</body>
</html>
